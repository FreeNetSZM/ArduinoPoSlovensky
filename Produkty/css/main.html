
<!DOCTYPE html>
<html lang="sk">     
  <head>         
    <meta charset="utf-8">      
    <link rel="stylesheet" href="/ArduinoPoSlovensky/Produkty/css/main.min.css">    
    <title>Arduino na AliExpresse</title>
    <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>
    <script>
      function ProduktID() { 
        var myObj;
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                myObj = JSON.parse(this.responseText);
            }
        };
        xmlhttp.open("GET", "https://freenetszm.github.io/ArduinoPoSlovensky/Produkty/css/main.min.json", true);
        xmlhttp.send();
        
        var i, id, div;        
        var max = Object.keys(myObj).length;
        var arg = Object.keys(myObj);
        var inner = arguments;

        for (i = 1; i < max; i++) {
          id = arg[i];
          div = document.createElement("div");
            div.setAttribute("id", id);
            div.setAttribute("class", "bannerID");
            div.innerHTML =
                  '<div class="banner_shadow">\n' +
                    '<div id="PRODUKT_IMG">\n' +
                      '<img class="ID_IMG" id="IMG-' + id +'"/>\n' +
                    '</div>\n' +
                    '<div class="POPIS" id="POPIS">\n' +
                      '<h5 class="NADPIS" id="NADPIS-' + id + '"></h5>\n' +
                       '<div id="OPIS-' + id + '"></div>\n' +
                    '</div>\n' +
                    '<div id="DOWN">\n' +
                      '<div id="DOWN_R">\n' +                  
                        '<span id="PRICE"><div id="PRICE-' + id + '"></div></span>\n' +
                        '<a target="_blank" class="KUP" id="KUP-' + id + '">\n' +
                        '<i id="KUP_PRED"></i> Kúp\n' +
                        '<i id="KUP_ZA"></i></a>\n' +
                      '</div>\n' +
                      '<a href="http://s.click.aliexpress.com/e/vR7maIuzV">\n' +
                        '<img src="https://freenetszm.github.io/ArduinoPoSlovensky/Produkty/images/ali.png" target="_blank" id="IMG_ALI"/></a>\n' + 
                      '<div class="star-ratings-sprite"><span style="width:1%" id="STAR-' + id + '" class="star-ratings-sprite-rating"></span></div><div id="SCORE-' + id + '"></div>\n' +        
                    '</div>\n' +
                '</div>\n'
            document.getElementById(inner).appendChild(div);
        }    

        $.getJSON('https://freenetszm.github.io/ArduinoPoSlovensky/Produkty/css/main.min.json', function(name) {
           for (i = 1; i < max; i++) {
              id = arg[i];
              document.getElementById("NADPIS-" + id).innerHTML = name[id][0];
              document.getElementById("OPIS-" + id).innerHTML = name[id][1];
              document.getElementById("KUP-" + id).href = name[id][2];      
           }
        });  

        for (i = 1; i < max; i++) {   
          id = arg[i];
          (function(id) {         
            $.getJSON('https://gw.api.alibaba.com/openapi/param2/2/portals.open/api.getPromotionProductDetail/38404?fields=salePrice,discount,evaluateScore&localCurrency=EUR&productId=' +id, function(data) {
              if (data.result == undefined) {document.getElementById("PRICE-" + id).innerHTML = "Dočasne nedostupné &nbsp&nbsp";}
                else {
                    if (data.result.discount == "0%") {document.getElementById("PRICE-" + id).innerHTML = data.result.salePrice + "&nbsp&nbsp";}
                      else {document.getElementById("PRICE-" + id).innerHTML = "aktuálna zľava: " + data.result.discount + "&nbsp&nbsp&nbsp" + data.result.salePrice + "&nbsp&nbsp";
                      }            
                    document.getElementById("STAR-" + id).style.width = (data.result.evaluateScore * 20) + "%";
                    document.getElementById("SCORE-" + id).innerHTML = data.result.evaluateScore;    
                  }
            });          
            $.getJSON('https://gw.api.alibaba.com/openapi/param2/2/portals.open/api.getAppPromotionProduct/38404?productId=' +id, function(img) {
              if (img.result == undefined) {document.getElementById("IMG-" + id).src = "https://freenetszm.github.io/ArduinoPoSlovensky/Produkty/images/aliexpress.jpg";} 
                else {document.getElementById("IMG-" + id).src = img.result.image220;}  
            });   
          })(id);
        } 
      }
    </script>
  </head>    
  <body> 
    <div id="1"></div>  
    <script>
      ProduktID(1);
    </script>
  </body>
</html>
